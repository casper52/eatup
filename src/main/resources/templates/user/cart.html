<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{/layout/layout_user}">


<div layout:fragment="content">

	<style>
* {
	margin: 0px;
	padding: 0px;
}


.col-lg-9 {
	item-align: center;
	text-align: center;
	margin: auto;
}

.f1 {
	background-color: #E9CC44;
	height: 100px;
}

.f2 {
	text-align: center;
}

.cartBtn {
	height: 100px;
	width: 100%;
	background-color: transparent;
}

.checked {
	color: orange;
}
</style>
	<!-- content -->

	<div class="col-lg-9">

		<h3>장바구니</h3>
		
		
			<table class="table">
				<thead class="thead-dark">
					<tr>
						<th scope="col"><div class="form-check form-check-inline"> <input class="selectAll form-check-input" type="checkbox" id="inlineCheckbox1" value="option1"  checked="checked">
  							<label class="form-check-label" for="inlineCheckbox1"></label></div></th>
						<th scope="col">메뉴</th>
						<th scope="col">수량</th>
						<th scope="col">가격</th>
						<th scope="col">변경</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="cart : ${cart}">
						<td><div class="form-check form-check-inline"> <input class="selectOne form-check-input" name="ckBox" type="checkbox" id="inlineCheckbox1" value="option1"  checked="checked">
  							<label class="form-check-label" for="inlineCheckbox1"></label></div></td>
						<td th:text="${cart.mname}"></td>
						<td><input th:value="${cart.quantity}" size="1" type="number" class="qty form-control" min="0" max="100"></td>
						<td id="price" th:text="${cart.mprice}"></td>
						<td><button class="editBtn btn btn-outline-warning">Edit</button></td>
					</tr>
					
				</tbody>
			</table>
<button class="editBtn btn btn-warning">선택수정</button>
<button class="editBtn btn btn-danger">선택삭제</button>

	<div class="col-lg-9">
				<h3>총 주문 금액</h3>
				<div class="facet f2" th:each="cart : ${cart}">
				<input type="hidden" class="getPrice" th:value="${cart.totalPrice}" th:attr="name='totlaPrice'">
				</div>
				<h4 class="totalPrice"></h4>
	</div>
		   <div class="col-md-5">
		<!-- end content -->
	</div>
	      	<div class="wrapper">
      		<div class="facet f1"> <button class="cartBtn btn btn-warning" th:onclick="|window.location.href='@{/user/pay(sno=${sno})}'|">주문하기</button></div>
      	</div>
</div>
</div>

<th:block layout:fragment="script">
<script th:inline="javascript">
window.onload = function(){
	
	var getCookie = $.cookie('cart');
	var cart = [[${cart}]];
	var idx = 0;
	
	console.log(getCookie); 
	

	$(".qty").attr("disabled",true); 

	
	//체크박스 전체선택, 해제
	$(".selectAll").click(function(){
		//클릭
		if($(".selectOne").prop("checked")){
			$("input[name=ckBox]").prop("checked", false);
		//논클릭
		}else{
			$("input[name=ckBox]").prop("checked", true);

		} //end if-else
	}) //end checkbox
	
	

	//총 주문금액
	$(".totalPrice").html(function(){
		
		idx = 0;
		
		//수량
		$(".qty").each(function(){
			
			idx += parseInt($(this).context.value);
			
			console.log("qty: " + $(this).context.value);
			
		});
		
		
		//가격
		$(".getPrice").each(function(){
			console.log($(this));
			
			idx += parseInt($(this).context.value);
		});
		
		return idx;
	
	}); //end totalPrice
	
	
	//Edit 버튼 클릭
	$(".editBtn").on("click", function(){
		
		$(".qty").removeAttr("disabled"); 
		
		//edit status
		 if( $(this).html() == 'Edit' ) {
		      $(this).html('Done');
		      
		    }
		
		//done status
		    else {
		      $(this).html('Edit');
		     
		      idx = 0;
		      
		     	for(var i = 0; i < getCookie[idx].length; i++){
		      
		     	 $(".qty").html($(".qty")[idx].value)
		      	.attr("disabled",true);
		     	 
		     	 
		      		      
		      
		  		}
		
		console.log("edit button click....");
		
		    }
		
	}); //end edit


	
	
}; // end window.onload
	
	
	
	
	

</script>
</th:block>